
<!DOCTYPE html>
<html>
<head>
  {% load static %}
  <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
  <title>Traffic List</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Navigation bar -->
  <div class="navbar">
    <div class="logo-container">
      <img src="https://www.shutterstock.com/image-vector/traffic-policeman-holding-stop-sign-260nw-640858120.jpg" alt="Traffic Police">
      <h1>Traffic List</h1>
    </div>
    <ul>
      <li><a href="/notice">Notice</a></li>
      <!-- <li><a href="#">Traffic List</a></li> -->
    </ul>
  </div>
  

  <div class="container">
    <div class="button-container">
      <button id="addButton"><i class="fas fa-plus" style="margin-right: 10px;"></i> Add</button>
    </div>

    <table>
      <tr>
        <th>TrafficBooth</th>
        <th>AreaCode</th>
        <th>Location</th>
        
       
      </tr>
      {% for traffic in traffic_list %}
      <tr>
        <td>{{traffic.TrafficBooth}}</td>
        <td>{{traffic.Areacode}}</td>
        <td>{{traffic.location}}</td>
        <td><button class="edit-button"><i class="fas fa-edit"></i> Edit</button></td>
       
        
      </tr>
      {% endfor %}
    </table>
    
  </div>


  <!-- Overlay model for registration of Traffic Booth -->
  <div id="registration_overlay" class="registration_overlay">
    <div class="message-box">
      <button id="closeButton" class="close-button">&times;</button>
      <h2>Register Traffic Booth</h2>
      <form action="{% url 'traffics' %}" method="POST">
        {% csrf_token %}
        <label for="trafficBooth">Traffic Booth:</label>
        <input type="text" id="trafficBooth" name="trafficBooth" required>
    
        <label for="areaCode">Area Code</label>
        <input type="text" id="areaCode" name="areaCode" required>
    
        <label for="location">Location</label>
        <input type="text" id="location" name="location" required>
    
        <button type="submit">Submit</button>
        
        
    </form>
    </div>
  </div>
  
  
  

  <script>
    const addButton = document.getElementById('addButton');
    const overlay = document.getElementById('registration_overlay');
    const closeButton = document.getElementById('closeButton');
    const areaCodeInput = document.getElementById('areaCode');
    const editButtons = document.getElementsByClassName('edit-button');
    


    addButton.addEventListener('click', () => {
      overlay.style.display = 'block';

       // Clear the input fields
       document.getElementById('trafficBooth').value = '';
      document.getElementById('areaCode').value = '';
      document.getElementById('location').value = '';
    });

    closeButton.addEventListener('click', () => {
      overlay.style.display = 'none';
    });
     // Add submit event listener to the form
  const registrationForm = document.querySelector('#registration_overlay form');

  registrationForm.addEventListener('submit', (event) => {
  const areaCodeValue = areaCodeInput.value.trim();
  const trafficBoothValue = trafficBoothInput.value.trim();
  
  if (!/^[0-9]+$/.test(areaCodeValue, trafficBoothValue )) {
    event.preventDefault(); // Prevent form submission
    alert('Traffic booth or Area code must only contain numeric values.');
  }
});

// ...

let selectedRow = null;

// Add event listeners to edit buttons
for (const editButton of editButtons) {
  editButton.addEventListener('click', () => {
    overlay.style.display = 'block';

    // Get the table row associated with the clicked edit button
    const row = editButton.parentNode.parentNode;

    // Get the data values from the table cells of the row
    const trafficBooth = row.cells[0].textContent;
    const areaCode = row.cells[1].textContent;
    const location = row.cells[2].textContent;

    // Populate the form with the existing data
    document.getElementById('trafficBooth').value = trafficBooth;
    document.getElementById('areaCode').value = areaCode;
    document.getElementById('location').value = location;

    

    // Set the selected row to the current row
    selectedRow = row;
  });
}

// Handle the submission of the edited data
registrationForm.addEventListener('submit', (event) => {
  event.preventDefault(); // Prevent form submission

  if (selectedRow) {
    // Get the edited values from the form
    const editedTrafficBooth = document.getElementById('trafficBooth').value;
    const editedAreaCode = document.getElementById('areaCode').value;
    const editedLocationInput = document.getElementById('location');
    let editedLocation = editedLocationInput.value;
    // Capitalize the first letter of the edited location
    editedLocation = capitalizeFirstLetter(editedLocation);

    // Update the selected row with the edited data
    selectedRow.cells[0].textContent = editedTrafficBooth;
    selectedRow.cells[1].textContent = editedAreaCode;
    selectedRow.cells[2].textContent = editedLocation;


   // Update the value in the form input field
    editedLocationInput.value = editedLocation;

    // Close the overlay after submission
    overlay.style.display = 'none';

    // Reset the selected row
    selectedRow = null;
  }else{
    // Create a new row for the added data
    const table = document.querySelector('table');
        const newRow = document.createElement('tr');
        const trafficBoothCell = document.createElement('td');
        const areaCodeCell = document.createElement('td');
        const locationCell = document.createElement('td');
        const editButtonCell = document.createElement('td');
        const editButton = document.createElement('button');
        const editIcon = document.createElement('i');

        trafficBoothCell.textContent = document.getElementById('trafficBooth').value;
        areaCodeCell.textContent = document.getElementById('areaCode').value;
        let newLocation = document.getElementById('location').value;
        newLocation = capitalizeFirstLetter(newLocation);
        locationCell.textContent = newLocation;
       
        editIcon.classList.add('fas', 'fa-edit');
        editButton.classList.add('edit-button');
        editButton.appendChild(editIcon);
        editButtonCell.appendChild(editButton);
        newRow.appendChild(trafficBoothCell);
        newRow.appendChild(areaCodeCell);
        newRow.appendChild(locationCell);
        newRow.appendChild(editButtonCell);
        table.appendChild(newRow);

    // Close the overlay after submission
    overlay.style.display = 'none';
      }

      // Submit the form
      registrationForm.submit();
    });

  function capitalizeFirstLetter(string) {
  return string.charAt(0).toUpperCase() + string.slice(1);
}
  
// ...



  </script>
</body>
</html>
