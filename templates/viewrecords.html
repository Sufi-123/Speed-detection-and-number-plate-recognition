

<html>
    <head>
        <link rel="stylesheet" href="../static/css/viewrecords.css">

</head>
    <body>
      {% if user.is_authenticated%}
      <h3>Hi </h3>
      <a href="{% url 'logout' %}">Logout</a> <br>
      {% else %}
      <a href="{% url 'login' %}">Login</a>
      {% endif %}

      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search by License Plate">
    </div>
    <!-- <div class="page-container">
      <input type="number" id="pageInput" placeholder="Page">
  </div> -->
        <table  id="myTable">
            <tr >
                <th >SN</th>
                <th>liscenceplate no</th>
                <th>Speed</th>
                <th>limit</th>
                <!-- <th>limit crossed</th> -->
                <th>Date</th>
                <th >ID</th>
                <th >count</th>
               
            </tr>
           
            {% for viewrecord in viewrecord_list %}
          <tr>
            <td>{{viewrecord.pk}}</td>
            <td>{{viewrecord.liscenceplate_no}}</td>
            <td>{{viewrecord.speed}}</td>
            <td>50</td>
            <td class="date-column">{{viewrecord.date}}</td>
            <td>{{viewrecord.IDs}}</td>
            <td>{{viewrecord.count}}</td>
          </tr>
          {% endfor %}

        </table>

        <div class="date-picker-container">
          <input type="date" id="datePicker">
      </div>
      <p align="right">
          <button onclick="generateCSV()" class="download-btn">Download CSV</button>
      </p>
  
    </body>
</html>



<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const table = document.getElementById('myTable');
    const rows = table.getElementsByTagName('tr');
    
    for (let i = 1; i < rows.length; i++) { // Start from 1 to skip the table header row
      const limitCell = rows[i].getElementsByTagName('td')[3];
      const speedCell = rows[i].getElementsByTagName('td')[2];
      
      const limit = parseInt(limitCell.innerText);
      const Speed = parseInt(speedCell.innerText);
      
      if (Speed > limit) {
        speedCell.style.backgroundColor = 'red';
      }
    }
  });

  //creating dunction for download button


  function generateCSV() {
    // Retrieve selected date from the input
    const selectedDate = document.getElementById("datePicker").value;

    // Filter the records based on the selected date
    const table = document.getElementById("myTable");
    const rows = table.getElementsByTagName("tr");
    const filteredRows = Array.from(rows).filter(row => {
      const dateColumn = row.querySelector(".date-column"); // Selector for the date column
      return dateColumn && dateColumn.textContent.trim() === selectedDate;
    });

    // Prepare the CSV data
    let csvData = "SN,liscenceplate no,Speed,Date\n"; // Header row
    filteredRows.forEach(row => {
      const rowData = Array.from(row.cells).map(cell => cell.textContent.trim());
      csvData += rowData.join(",") + "\n";
    });

    // Trigger the download
    const blob = new Blob([csvData], { type: "text/csv;charset=utf-8;" });
    const downloadLink = document.createElement("a");
    downloadLink.href = URL.createObjectURL(blob);
    downloadLink.download = "filtered_records.csv";
    downloadLink.style.display = "none";
    document.body.appendChild(downloadLink);
    downloadLink.click();
    document.body.removeChild(downloadLink);
  }



  // function generateCSV() {
  //   // Retrieve selected date from the input
  //   const selectedDate = document.getElementById("datePicker").value;

  //   // Filter the records based on the selected date
  //   const table = document.getElementById("myTable");
  //   const rows = table.getElementsByTagName("tr");
  //   const filteredRows = Array.from(rows).filter(row => {
  //     const dateColumn = row.querySelector(".date-column"); // Replace with the appropriate selector for the date column
  //     return dateColumn && dateColumn.textContent.trim() === selectedDate;
  //   });

  //   // Prepare the CSV data
  //   let csvData = "SN,liscenceplate no,Speed,Date\n"; // Header row
  //   filteredRows.forEach(row => {
  //     const snColumn = row.querySelector("td:nth-child(1)"); // Replace with the appropriate selector for the SN column
  //     const licensePlateColumn = row.querySelector("td:nth-child(2)"); // Replace with the appropriate selector for the license plate number column
  //     const speedColumn = row.querySelector("td:nth-child(3)"); // Replace with the appropriate selector for the speed column
  //     const dateColumn = row.querySelector(".date-column"); // Replace with the appropriate selector for the date column

  //     csvData += `${snColumn.textContent.trim()},${licensePlateColumn.textContent.trim()},${speedColumn.textContent.trim()},${dateColumn.textContent.trim()}\n`;
  //   });

  //   // Trigger the download
  //   const blob = new Blob([csvData], { type: "text/csv;charset=utf-8;" });
  //   const downloadLink = document.createElement("a");
  //   downloadLink.href = URL.createObjectURL(blob);
  //   downloadLink.download = "filtered_records.csv";
  //   downloadLink.style.display = "none";
  //   document.body.appendChild(downloadLink);
  //   downloadLink.click();
  //   document.body.removeChild(downloadLink);
  // }


</script>
